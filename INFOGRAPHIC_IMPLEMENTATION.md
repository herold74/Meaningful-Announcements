# Infographic Implementation Summary

## Overview
This document outlines the implementation of an AI-generated HTML/CSS infographic that appears at the top of each technical guide page. The infographic visualizes business value for salespeople using only the Gemini API key.

---

## Architecture

### Solution Design
Since Imagen 3 requires Vertex AI (not available with standard Gemini API keys), we implemented an HTML/CSS-based infographic generated by Gemini's text model. This provides:
- Visual business value representation
- Red Hat brand compliance
- Zero dependency on image generation APIs
- Fast, parallel generation with guide content

---

## Code Implementation

### 1. Backend Service (`aiService.js`)

#### Infographic Generation Function

```javascript
// Helper to generate infographic HTML visualization
async function generateInfographicHTML(feature, useCase) {
    try {
        console.log("Generating business value infographic...");
        const prompt = `Create an HTML/CSS infographic visualization that shows the business value of "${feature.featureName}" for the use case: "${useCase}".

The infographic should be a complete HTML snippet (div with inline styles) that:
- Visualizes the transformation or business impact in a clear, professional way
- Uses a modern, corporate design with Red Hat colors (red: #cc0000, blue: #0066cc, gray: #777)
- Shows before/after comparison OR a flow diagram OR key metrics
- Is visually striking and easy for salespeople to understand at a glance
- Uses flexbox or grid for layout, boxes/cards for content
- Includes icons represented by unicode symbols or colored boxes
- Should be 100% width, max 600px height

Return ONLY the HTML div with inline styles, no explanations.`;
        
        const response = await ai.models.generateContent({
            model: GEMINI_MODEL_GUIDE,
            contents: prompt,
            config: { temperature: 0.7 }
        });

        let htmlInfographic = response.text.replace(/```(html)?/g, '').trim();
        return htmlInfographic;

    } catch (error) {
        console.error("Infographic Generation Error:", error);
        return null;
    }
}
```

#### Guide Generation with Parallel Processing

```javascript
async function generateGuide(feature, useCase, provider = 'gemini') {
    const guidePrompt = `
        You are a technical writer. Write a comprehensive, step-by-step technical guide for a user.
        The guide should focus on the new Red Hat feature: **${feature.featureName}** (Summary: ${feature.featureSummary}).
        The entire guide must be contextualized around the following real-world scenario/use case: **${useCase}**.

        The guide must be returned as a complete HTML snippet (excluding <html>, <head>, and <body> tags, but including <h2>, <p>, <h3>, <ul>, and <code> tags).
        
        IMPORTANT: Do NOT include any <h1> tags, images, or infographic content. The infographic will be added separately at the top of the page.
        
        The guide should be professional, instructive, and include ONLY the following sections:
        1. An introduction relating the feature to the use case.
        2. Prerequisites (e.g., 'RHEL 9', 'OpenShift Cluster access').
        3. A section of at least 3-10 actionable, technical steps/commands with brief explanations.
        4. A conclusion on the value proposition.
    `;

    try {
        // Start infographic HTML generation in parallel with text generation
        const infographicPromise = generateInfographicHTML(feature, useCase);
        
        let textPromise;
        if (provider === 'openai') {
            textPromise = openai.chat.completions.create({
                model: CHATGPT_MODEL_GUIDE,
                messages: [{ role: "user", content: guidePrompt }],
                temperature: 0.7,
            }).then(res => res.choices[0].message.content);

        } else { // 'gemini'
            textPromise = ai.models.generateContent({
                model: GEMINI_MODEL_GUIDE,
                contents: guidePrompt,
                config: { temperature: 0.7 }
            }).then(res => res.text);
        }

        const [infographicResult, textResult] = await Promise.all([infographicPromise, textPromise]);

        let html = textResult.replace(/```(html)?/g, '').trim();
        
        // Remove any infographic-related sections that the AI might have generated
        // Match from "Infographic" heading to the next heading or end of content
        html = html.replace(/<h[1-6][^>]*>.*?Infographic.*?<\/h[1-6]>[\s\S]*?(?=<h[1-6]|$)/gi, '');
        html = html.replace(/<h[1-6][^>]*>.*?Business Value Visualization.*?<\/h[1-6]>[\s\S]*?(?=<h[1-6]|$)/gi, '');
        
        // Remove any standalone image tags that might have been generated
        html = html.replace(/<img[^>]*>/gi, '');
        
        // Clean up multiple consecutive line breaks and empty elements
        html = html.replace(/(<br\s*\/?>\s*){3,}/gi, '<br><br>');
        html = html.replace(/<div[^>]*>\s*<\/div>/gi, '');
        html = html.replace(/<section[^>]*>\s*<\/section>/gi, '');
        html = html.trim();

        return {
            infographicHtml: infographicResult,
            html: html
        };

    } catch (error) {
        console.error(`[${provider.toUpperCase()}] API Guide Generation Error:`, error);
        return {
            infographicHtml: null,
            html: "<h3>Error Generating Guide</h3><p>Could not generate the technical guide using the selected AI provider.</p>"
        };
    }
}
```

---

### 2. Route Handler (`app.js`)

```javascript
// Route to generate and display the specific guide
app.get('/guide/:articleIndex/:featureIndex/:useCaseIndex', async (req, res) => {
    
    // ... validation code ...

    const useCase = feature.potentialUseCases[useCaseIndex];
    const generationProvider = article.extractionProvider || getProvider(req);
    
    try {
        console.log(`Generating Guide using ${generationProvider.toUpperCase()} for cached feature: ${feature.featureName}`);
        
        // --- Guide Generation (This is still an API call) ---
        const guideData = await generateGuide(feature, useCase, generationProvider);

        res.render('guide', {
            title: `Guide: ${feature.featureName} [${generationProvider.toUpperCase()}]`,
            articleTitle: article.title,
            featureName: feature.featureName,
            useCase: useCase,
            infographicHtml: guideData.infographicHtml,  // Pass HTML instead of URL
            guideHtml: guideData.html,
            currentProvider: generationProvider
        });

    } catch (error) {
        console.error('Error generating guide:', error);
        res.status(500).send('Error generating the guide.');
    }
});
```

---

### 3. Template (`views/guide.hbs`)

```handlebars
<!DOCTYPE html>
<html>
<head>
    <title>{{title}}</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1, h2, h3 { color: #cc0000; }
        pre, code { background: #eee; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        .use-case-box { border: 2px solid #007bff; padding: 15px; margin: 20px 0; background: #e6f0ff; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>{{featureName}}</h1>
    <p>Source Article: <a href="#">{{articleTitle}}</a></p>

    <div class="use-case-box">
        <h2>Real-World Use Case:</h2>
        <p><strong>{{useCase}}</strong></p>
    </div>

    {{#if infographicHtml}}
    <div style="margin-bottom: 30px;">
        {{{infographicHtml}}}
    </div>
    {{/if}}

    {{{guideHtml}}}

    <hr>
    <p><a href="/">‚Üê Back to Announcements</a></p>
</body>
</html>
```

---

## Key Features

### 1. Parallel Processing
- Infographic and guide text are generated simultaneously
- Reduces total API wait time by ~50%

### 2. Content Sanitization
- Removes any AI-generated infographic sections from guide text
- Strips out unwanted image tags
- Cleans up empty HTML elements

### 3. Brand Compliance
- Prompts explicitly request Red Hat colors (#cc0000, #0066cc, #777)
- Ensures professional, corporate design
- Optimized for sales team consumption

### 4. Positioning
The infographic appears:
1. After the feature name heading
2. After the blue "Real-World Use Case" box
3. **Before** the technical guide content
4. At the top portion of the page for maximum visibility

---

## API Requirements

### Environment Variables (`.env`)
```bash
API_KEY="your_gemini_api_key_here"
```

### Models Used
- **Text Generation**: `gemini-2.5-pro` (for both guide and infographic)
- **Feature Extraction**: `gemini-2.5-flash`

---

## Troubleshooting

### Issue: No infographic appears
**Solution**: Check console logs for "Generating business value infographic..." message. Ensure API key has proper permissions.

### Issue: Infographic appears at bottom
**Solution**: Verify template is using `{{{infographicHtml}}}` with triple braces and positioned after the use-case-box div.

### Issue: Duplicate infographics
**Solution**: The post-processing regex should remove AI-generated infographic sections. Check that the cleanup code is running.

---

## Future Enhancements

- Add caching for generated infographics
- Implement fallback templates if AI generation fails
- Add user ability to regenerate infographic with different styles
- Support for different visualization types (charts, diagrams, metrics)

---

## License & Credits

This implementation uses:
- **Gemini API** for content generation
- **Handlebars** for templating
- **Express.js** for routing

